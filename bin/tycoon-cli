#!/usr/bin/env python
# -*- encoding: utf-8 -*-
import argparse
import sys
import traceback

from selenium import webdriver
from selenium.webdriver.chrome.options import Options
from webdriver_manager.chrome import ChromeDriverManager
from selenium.webdriver.chrome.service import Service as ChromiumService

from tycoon.aircraft import Aircraft
from tycoon.long_hauls import LongHauls
from tycoon.circuit import Circuit
from tycoon.seat import Seat
from tycoon.utils import log

parser = argparse.ArgumentParser()
parser.add_argument(
    "-d", "--debug", dest="debug_mode", action="store_true", help="Debug mode on."
)
parser.add_argument(
    "--no_headless",
    "-nh",
    action="store_true",
    help="Disable headless and show browser",
)
sub_parsers = parser.add_subparsers(help="Sub-commands", dest="command", required=True)

chrome_options = Options()
chrome_options.add_argument("--window-size=1920x1080")
chrome_options.add_argument("--log-level=4")


COMMANDS = {
    "aircraft": Aircraft,
    "seat": Seat,
    "long_hauls": LongHauls,
    "circuit": Circuit,
}


if __name__ == "__main__":
    for k, v in COMMANDS.items():
        getattr(v, "options")(sub_parsers)
    options, _ = parser.parse_known_args()
    log.setup(options.debug_mode)
    try:
        manager = ChromeDriverManager(version="105.0.5195.52").install()
        if not options.no_headless:
            chrome_options.add_argument("--headless")

        driver = webdriver.Chrome(
            service=ChromiumService(manager),
            options=chrome_options,
        )
        for k, v in COMMANDS.items():
            if options.command == k:
                getattr(v(driver, options), "run")()

    except Exception:
        traceback.print_exception(*sys.exc_info())
    finally:
        driver.quit()
        print("Done")
